<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
          integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">

    <title>Add Product</title>
</head>
<body>
<div id="products" class="d-flex p-2 justify-content-center">
    <div>
        <table class="table table-dark table-fit">
            <thead>
            <tr>
                <th scope="col">Product Name</th>
                <th scope="col">Description</th>
                <th scope="col">Price</th>
                <th scope="col">Quantity</th>
                <th scope="col"></th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td class="text-center">
                    <input type="text" class="form-control" id="name" name="name" placeholder="Enter name">
                </td>
                <td class="text-center">
                    <input type="text" class="form-control" id="description" name="description"
                           placeholder="Enter description">
                </td>
                <td class="text-center">
                    <input type="number" step="0.01" class="form-control" id="price" name="price"
                           placeholder="Enter price">
                </td>
                <td class="text-center">
                    <input type="number" step="1" class="form-control" id="quantity" name="quantity"
                           placeholder="Enter quantity">
                </td>
                <td class="text-center">
                    <button id="addButton" type="button" class="btn btn-success">Add</button>
                </td>
            </tr>
            <% data.forEach(function(item, index) { %>
                <tr>
                    <td class="text-center"> <%= item.name %> </td>
                    <td class="text-center"> <%= item.description %> </td>
                    <td class="text-center"> $<%= item.price %> </td>
                    <td class="text-center"> <%= item.quantity %> </td>
                    <td class="text-center">
                        <button data-name="<%= item.name %>" type="button" class="btn btn-primary m-2 editButton">Edit
                        </button>
                        <button data-name="<%= item.name %>" type="button" class="btn btn-danger m-2 deleteButton">
                            Delete
                        </button>
                    </td>
                </tr>
            <% }); %>
            </tbody>
        </table>
    </div>
</div>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
        integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
        integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
        crossorigin="anonymous"></script>

<script>
    $(document).ready(function () {

        $(document).on('click', '.deleteButton', function () {
            event.preventDefault();
            event.stopPropagation();
            getProductName(this);
        });

        $(document).on('click', '#addButton', function () {
            let newProductHash = {}
            newProductHash['name'] = document.getElementById("name").value;
            newProductHash['description'] = document.getElementById("description").value;
            newProductHash['price'] = document.getElementById("price").value;
            newProductHash['quantity'] = document.getElementById("quantity").value;

            for (let key in newProductHash) {
                if (newProductHash[key] === "" || !newProductHash[key]) {
                    alert("ALL FIELDS MUST BE FILLED");
                    return;
                }
            }
            addProduct(newProductHash);
        });


        function reloadTable() {
            $('#products').load(document.URL + ' #products');
        }

        function getProductName(button) {
            let name = button.getAttribute("data-name");
            deleteProduct(name);
        }

        function addProduct(newProductHash) {
            $.ajax({

                url: "/products",
                data: {
                    name: newProductHash['name'],
                    description: newProductHash['description'],
                    price: newProductHash['price'],
                    quantity: newProductHash['quantity']
                },
                type: 'POST',
                success: function () {
                    reloadTable();
                },
                error: function (request, error) {
                    alert("Request: " + JSON.stringify(error));
                }
            });
        }

        function deleteProduct(productName) {
            $.ajax({

                url: "/products/" + productName,
                type: 'DELETE',
                success: function () {
                    reloadTable();
                },
                error: function (request, error) {
                    alert("Request: " + JSON.stringify(error));
                }
            });
        }
    });
</script>
</body>
</html>